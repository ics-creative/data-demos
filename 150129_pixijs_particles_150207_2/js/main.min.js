var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c};window.addEventListener("load",function(){new Main});var Main=function(){function a(){var a=this;this.stage=new PIXI.Stage(0),this.rendereer=PIXI.autoDetectRenderer(800,600,null,!0,!0),document.body.appendChild(this.rendereer.view);var b=new ParticleSample;this.stage.addChild(b),createjs.Ticker.timingMode=createjs.Ticker.RAF,createjs.Ticker.on("tick",this.handleTick,this),this.handleResize(),window.addEventListener("resize",function(){a.handleResize()})}return a.prototype.handleTick=function(){this.rendereer.render(this.stage)},a.prototype.handleResize=function(){this.rendereer.resize(innerWidth,innerHeight)},a}(),ParticleSample=function(a){function b(){var b=this;a.call(this),this._count=0,this._bg=new PIXI.Graphics,this.addChild(this._bg),this._lines=new PIXI.Graphics,this.addChild(this._lines),this._linePoint=[],this._emitter=new ParticleEmitter,this.addChild(this._emitter.container),this._shadow=new PIXI.Sprite(PIXI.Texture.fromImage("imgs/Shadow.png")),this.addChild(this._shadow),this.mouseDown=this.touchstart=function(a){b.mouseDown(a)},this.mouseUp=this.mouseupoutside=this.touchend=function(a){b.mouseUp(a)},createjs.Ticker.on("tick",this.enterFrameHandler,this),this.handleResize(),window.addEventListener("resize",function(){b.handleResize()})}return __extends(b,a),b.prototype.enterFrameHandler=function(){var a=this.stage.getMousePosition();this._emitter.latestX=a.x,this._emitter.latestY=a.y;createjs.Graphics.getHSL((new Date).getTime()/40,80,60),createjs.Graphics.getHSL(((new Date).getTime()+2400)/40,90,80);this._bg.clear(),this._bg.beginFill(0),this._bg.drawRect(0,0,window.innerWidth,window.innerHeight),this._emitter.update(),this._isDown?this._linePoint.push({x:this._emitter.x,y:this._emitter.y,vx:this._emitter.vx,vy:this._emitter.vy}):this._linePoint.shift(),this._lines.clear();for(var b=this._linePoint.length-1,c=1,d=6,e=0;b>e;e++){var f=this._linePoint[e],g=this._linePoint[e+1];this._lines.lineStyle(3,16777215),this._lines.moveTo(f.x,f.y),this._lines.lineTo(g.x,g.y);for(var h=0;d>h;h++){var i=f.x+f.vx*c*(h-d/2),j=f.y+f.vy*c*(h-d/2),k=g.x+g.vx*c*(h-d/2),l=g.y+g.vy*c*(h-d/2);this._lines.lineStyle(Math.abs(d-h+d/2)/2,16777215),this._lines.moveTo(i,j),this._lines.lineTo(k,l)}}b>18&&this._linePoint.shift()},b.prototype.mouseDown=function(){createjs.Ticker.on("tick",this.createParticle,this),this._isDown=!0},b.prototype.mouseUp=function(){createjs.Ticker.off("tick",this.createParticle),this._isDown=!1},b.prototype.createParticle=function(){var a=this.stage.getMousePosition();this._emitter.emit(a.x,a.y)},b.prototype.handleResize=function(){this._shadow.scale.x=window.innerWidth/1024,this._shadow.scale.y=window.innerHeight/1024},b}(PIXI.DisplayObjectContainer),Emitter=function(){function a(){this.vy=0,this.vx=0,this.x=0,this.y=0,this.latestX=0,this.latestY=0}return a.prototype.update=function(){var a=this.latestX-this.x,b=this.latestY-this.y,c=.2*Math.sqrt(a*a+b*b),d=Math.atan2(b,a);this.vx+=Math.cos(d)*c,this.vy+=Math.sin(d)*c,this.vx*=.4,this.vy*=.4,this.x+=this.vx,this.y+=this.vy},a}(),ParticleEmitter=function(a){function b(){a.call(this),this.numParticles=3,this.PRE_CACHE_PARTICLES=300,this.container=new PIXI.DisplayObjectContainer,this._particleActive=[],this._particlePool=[];for(var b=0;b<this.PRE_CACHE_PARTICLES;b++)this._particlePool.push(new Particle)}return __extends(b,a),b.prototype.emit=function(a,b){for(var c=0;c<this.numParticles;c++)this.getNewParticle(a,b)},b.prototype.update=function(){a.prototype.update.call(this);for(var b=0;b<this._particleActive.length;b++){var c=this._particleActive[b];c.getIsDead()?this.removeParticle(c):(c.y>=window.innerHeight?(c.vy*=-.9,c.y=window.innerHeight):c.y<=0&&(c.vy*=-.9,c.y=0),c.x>=window.innerWidth?(c.vx*=-.9,c.x=window.innerWidth):c.x<=0&&(c.vx*=-.9,c.x=0),c.update())}},b.prototype.getNewParticle=function(){var a=this.fromPool();return a.resetParameters(this.x,this.y,this.vx,this.vy),this._particleActive.push(a),this.container.addChild(a),a},b.prototype.removeParticle=function(a){this.container.removeChild(a);var b=this._particleActive.indexOf(a);b>-1&&this._particleActive.splice(b,1),this.toPool(a)},b.prototype.getActiveParticles=function(){return this._particleActive},b.prototype.fromPool=function(){return this._particlePool.length>0?this._particlePool.shift():new Particle},b.prototype.toPool=function(a){this._particlePool.push(a)},b}(Emitter),Particle=function(a){function b(){var b=new createjs.Shape;this.size=Math.random()*Math.random()*Math.random()*120+3;var c=createjs.Graphics.getHSL(160+20*Math.random(),0+20*Math.random(),50+50*Math.random());b.graphics.clear(),Math.random()<.5?b.graphics.beginRadialGradientFill([c,"#000000"],[0,1],0,0,this.size/10,0,0,this.size):Math.random()<.5?b.graphics.beginFill(c):b.graphics.setStrokeStyle(2).beginStroke(createjs.Graphics.getRGB(255,255,255)),b.graphics.drawCircle(0,0,this.size),b.graphics.endFill();var d=2;b.cache(-this.size-d,-this.size-d,2*this.size+2*d,2*this.size+2*d);var e=PIXI.Texture.fromCanvas(b.cacheCanvas);a.call(this,e),this._destroy=!0}return __extends(b,a),b.prototype.resetParameters=function(a,b,c,d){this.x=a,this.y=b,this.vx=.5*c+10*(Math.random()-.5),this.vy=.5*d+10*(Math.random()-.5),this.life=60*Math.random()+4,this._count=0,this._destroy=!1,this.alpha=1,this.scale.x=this.scale.y=1},b.prototype.update=function(){this.x+=this.vx,this.y+=this.vy,this._count++;var a=1-this._count/this.life/2;this.alpha=.6*Math.random()+.4,this.scale.x=this.scale.y=a,this.life<this._count&&(this._destroy=!0,this.parent.removeChild(this))},b.prototype.getIsDead=function(){return this._destroy},b}(PIXI.Sprite);